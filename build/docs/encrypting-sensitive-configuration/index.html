<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.70">
<link rel="alternate" type="application/rss+xml" href="silta/build/blog/rss.xml" title="Silta Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="silta/build/blog/atom.xml" title="Silta Blog Atom Feed"><title data-react-helmet="true">Encrypting sensitive configuration | Silta</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Encrypting sensitive configuration | Silta"><meta data-react-helmet="true" name="description" content="Certain configuration items such as access tokens or secret keys are quite sensitive"><meta data-react-helmet="true" property="og:description" content="Certain configuration items such as access tokens or secret keys are quite sensitive"><meta data-react-helmet="true" property="og:url" content="https://wunder.io/silta/build/docs/encrypting-sensitive-configuration"><link data-react-helmet="true" rel="shortcut icon" href="silta/build/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://wunder.io/silta/build/docs/encrypting-sensitive-configuration"><link rel="stylesheet" href="silta/build/styles.3ed084c4.css">
<link rel="preload" href="silta/build/styles.d933b987.js" as="script">
<link rel="preload" href="silta/build/runtime~main.f542c93b.js" as="script">
<link rel="preload" href="silta/build/main.27dcdfd0.js" as="script">
<link rel="preload" href="silta/build/1.acacd4cd.js" as="script">
<link rel="preload" href="silta/build/2.659e8141.js" as="script">
<link rel="preload" href="silta/build/43.9aab0c80.js" as="script">
<link rel="preload" href="silta/build/44.0616f134.js" as="script">
<link rel="preload" href="silta/build/935f2afb.9ef9ecc2.js" as="script">
<link rel="preload" href="silta/build/17896441.4e200198.js" as="script">
<link rel="preload" href="silta/build/e14059c9.70a9a436.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<nav aria-label="Skip navigation links"><button type="button" tabindex="0" class="skipToContent_11B0">Skip to main content</button></nav><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/silta/build/docs/silta/build/"><img src="silta/build/img/logo.svg" alt="Wunder Silta" class="themedImage_YANc themedImage--light_3CMI navbar__logo"><img src="silta/build/img/logo.svg" alt="Wunder Silta" class="themedImage_YANc themedImage--dark_3ARp navbar__logo"></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/silta/build/docs/silta/build/docs/anatomy-of-silta">Docs</a><a class="navbar__item navbar__link" href="/silta/build/docs/silta/build/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/wunderio/silta" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_2N3Q"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_3NWk">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_3NWk">ðŸŒž</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/silta/build/docs/silta/build/"><img src="silta/build/img/logo.svg" alt="Wunder Silta" class="themedImage_YANc themedImage--light_3CMI navbar__logo"><img src="silta/build/img/logo.svg" alt="Wunder Silta" class="themedImage_YANc themedImage--dark_3ARp navbar__logo"></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/silta/build/docs/silta/build/docs/anatomy-of-silta">Docs</a></li><li class="menu__list-item"><a class="menu__link" href="/silta/build/docs/silta/build/blog">Blog</a></li><li class="menu__list-item"><a href="https://github.com/wunderio/silta" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_vMrn"><div class="docSidebarContainer_3Ak5" role="complementary"><div class="sidebar_3gvy"><div class="menu menu--responsive thin-scrollbar menu_1yIk"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_1CUI" width="24" height="24" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Docs</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/silta/build/docs/silta/build/docs/anatomy-of-silta">Anatomy of a Silta project</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/silta/build/docs/silta/build/docs/circleci-conf-examples">CircleCI configuration examples</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/silta/build/docs/silta/build/docs/creating-new-project">Creating a new project</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/silta/build/docs/silta/build/docs/deployment-workflow">Deployment workflow</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/silta/build/docs/silta/build/docs/docker-images">Docker images</a></li><li class="menu__list-item"><a class="menu__link menu__link--active" tabindex="0" href="/silta/build/docs/silta/build/docs/encrypting-sensitive-configuration">Encrypting sensitive configuration</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/silta/build/docs/silta/build/docs/go-live-checklist">Go-live checklist</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/silta/build/docs/silta/build/docs/help-with-silta-dev">Helping with Silta development</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/silta/build/docs/silta/build/docs/key-components">Key components</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/silta/build/docs/silta/build/docs/migrating-an-existing-drupal-project">Migrating an existing Drupal project</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/silta/build/docs/silta/build/docs/request-workflow">Request workflow</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/silta/build/docs/silta/build/docs/silta-examples">Silta examples</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/silta/build/docs/silta/build/docs/troubleshooting">Troubleshooting</a></li></ul></li></ul></div></div></div><main class="docMainContainer_2iGs"><div class="container padding-vert--lg docItemWrapper_1bxp"><div class="row"><div class="col docItemCol_U38p"><div class="docItemContainer_a7m4"><article><header><h1 class="docTitle_Oumm">Encrypting sensitive configuration</h1></header><div class="markdown"><p>Certain configuration items such as access tokens or secret keys are quite sensitive
and should not be committed to the repository in plain text. Silta supports decrypting certain files
during the build process.</p><p>We use <code>openssl</code> to encrypt files, but there are many versions available with incompatible ciphers.
We therefore recommend the following process:</p><ul><li><p>SSH into a CircleCI environment using &quot;Rerun workflow &gt; Rerun job with SSH&quot; from the last build. Note that different environments might have different circleci contexts and hence - different encryption keys. Check your circleci config file for context information.
You will get a command like (the actual IP and port changes for each build)</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-bash codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token function" style="color:rgb(130, 170, 255)">ssh</span><span class="token plain"> -p </span><span class="token number" style="color:rgb(247, 140, 108)">64537</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">3.80</span><span class="token plain">.240.10</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>If you have trouble getting in, please refer to <code>troubleshooting.md</code> SSH section.</p></li><li><p>Create your file named <code>/tmp/secret_file</code>.</p></li><li><p>Encrypt it with</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">openssl aes-256-cbc -pbkdf2 -in /tmp/secret_file -out /tmp/encrypted_file -pass env:SECRET_KEY</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>Make sure that the <code>-in</code> and <code>-out</code> parameters are not the same, or openssl will encrypt its own output.</p></li><li><p>Now copy the encrypted file back to your local environment with</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-bash codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token function" style="color:rgb(130, 170, 255)">scp</span><span class="token plain"> -P </span><span class="token number" style="color:rgb(247, 140, 108)">64537</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">3.80</span><span class="token plain">.240.10:/tmp/encrypted_file path/to/file</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>The port and IP should be the same as the SSH instructions. Note that <code>-P</code> is uppercase for <code>scp</code>!</p></li><li><p>Commit the encrypted file to git at the location where you want to have it.</p></li><li><p>In your CircleCI configuration, add following </p><ul><li><em>Drupal chart</em>: Add following under <code>silta/drupal-build-deploy</code>:</li></ul><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">decrypt_files: path/to/file</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><ul><li><em>Frontend chart</em>: Add following under <code>codebase-build</code>:</li></ul><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">- silta/decrypt-files:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    files: path/to/file</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><ul><li><code>path/to/file</code> is relative to the build folder (root)</li></ul></li><li><p>Your secret file can also contain an extension to the configuration in silta.yml, for example to set encrypted environment variables. To do that, add this to your <code>drupal-build-deploy</code> CircleCI job:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">silta_config: silta/silta.yml,silta/secrets</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div></li><li><p>Push your code, the file will get decrypted in place at the build time.
Check the CircleCI step &quot;Decrypt secret files&quot;.</p></li><li><p>Your secret file can be used as it is (for example, the private key to connect to another service).</p></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="example-of-secret-environment-variables"></a>Example of secret environment variables<a class="hash-link" href="#example-of-secret-environment-variables" title="Direct link to heading">#</a></h2><p><em>Drupal chart</em></p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">php:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  env:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    PAYMENT_GW_KEY: &#x27;1234567890qwertyuiop&#x27;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p><em>Frontend chart</em></p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">services:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  myservice:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    env:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      PAYMENT_GW_KEY: &#x27;1234567890qwertyuiop&#x27;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="using-a-custom-encryption-key"></a>Using a custom encryption key<a class="hash-link" href="#using-a-custom-encryption-key" title="Direct link to heading">#</a></h2><p>For cases where you want to have your own encryption key, you can do that with the following steps:</p><ul><li>Create an environment variable in your CircleCI project.
Click the gear icon on a build page &gt; Environment variables &gt; Add Variable.
Use a name like <code>MYPROJECT_SECRET_KEY</code> and the value of your choice (preferably a strong key).</li><li>Use the same step as above, but specify the environment variable to be used as the decryption key:<div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">- silta/decrypt-files:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    files: path/to/file</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    secret_key_env: MYPROJECT_SECRET_KEY</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="decrypting-existing-secrets-file"></a>Decrypting existing secrets file<a class="hash-link" href="#decrypting-existing-secrets-file" title="Direct link to heading">#</a></h2><p>Check the port and IP address by Rerunning the latest workflow in CircleCI: &gt; Rerun job with SSH</p><p>Using the SSH port and IP address securely copy your silta/secrets file to CircleCI</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">scp -P 64537 silta/secrets 3.80.240.10:/tmp/encrypted_file</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>SSH to CircleCI using the correct port/IP you got from rerunning the job with SSH</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">ssh -p 64537 3.80.240.10</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>Run following command in CircleCI:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">openssl aes-256-cbc -pbkdf2 -d -in /tmp/encrypted_file -out /tmp/decrypted_file -pass env:SECRET_KEY</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>Check <code>/tmp/decrypted_file</code> or scp it back to your local using</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">scp -P 64537 3.80.240.10:/tmp/decrypted_file silta/secrets_decrypted</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/wunderio/silta/docs/encrypting_sensitive_configuration.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" role="img" viewBox="0 0 40 40" class="iconEdit_2LL7"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/silta/build/docs/silta/build/docs/docker-images"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« Docker images</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/silta/build/docs/silta/build/docs/go-live-checklist"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Go-live checklist Â»</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_2xL- thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#example-of-secret-environment-variables" class="table-of-contents__link">Example of secret environment variables</a></li><li><a href="#using-a-custom-encryption-key" class="table-of-contents__link">Using a custom encryption key</a></li><li><a href="#decrypting-existing-secrets-file" class="table-of-contents__link">Decrypting existing secrets file</a></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Docs</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/silta/build/docs/silta/build/docs/">Style Guide</a></li><li class="footer__item"><a class="footer__link-item" href="/silta/build/docs/silta/build/docs/doc2/">Second Doc</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Community</h4><ul class="footer__items"><li class="footer__item"><a href="https://www.facebook.com/wunder.io" target="_blank" rel="noopener noreferrer" class="footer__link-item">Facebook</a></li><li class="footer__item"><a href="https://www.linkedin.com/company/wunder.io" target="_blank" rel="noopener noreferrer" class="footer__link-item">Linkedin</a></li><li class="footer__item"><a href="https://twitter.com/Wunder_io" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter</a></li><li class="footer__item"><a href="https://www.instagram.com/wunder.io/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Instagram</a></li><li class="footer__item"><a href="https://www.youtube.com/channel/UCsBoaJt5sX12IFBu1giXZJg" target="_blank" rel="noopener noreferrer" class="footer__link-item">Youtube</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">More</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/silta/build/docs/silta/build/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2021 Wunder</div></div></div></footer></div>
<script src="silta/build/styles.d933b987.js"></script>
<script src="silta/build/runtime~main.f542c93b.js"></script>
<script src="silta/build/main.27dcdfd0.js"></script>
<script src="silta/build/1.acacd4cd.js"></script>
<script src="silta/build/2.659e8141.js"></script>
<script src="silta/build/43.9aab0c80.js"></script>
<script src="silta/build/44.0616f134.js"></script>
<script src="silta/build/935f2afb.9ef9ecc2.js"></script>
<script src="silta/build/17896441.4e200198.js"></script>
<script src="silta/build/e14059c9.70a9a436.js"></script>
</body>
</html>